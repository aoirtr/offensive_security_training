# 20210905

## THM

### room/wireshark

#### HTTPS Traffic

* HTTPSの通信が始まる前のステップ
  * クライアントとサーバーはプロトコルのバージョンに同意する
  * クライアントとサーバーは、暗号アルゴリズムを選択します
  * Optional: クライアントとサーバが相互に認証を行う
  * 公開鍵を使って安全なトンネルを作成する
* 暗号化された通信を読むためには秘密鍵が必要になる
  * 秘密鍵を入手できている場合、以下の手順で秘密鍵をセットできる
  * Edit > Preferences > Protocols > TLS > [+]
* デクリプトされたデータストリームはHTTPとして見ることができる
  * File > Export Objects > HTTP

#### Analyzing Exploit PCAPs

* Zerologon（CVE-2020-1472）のAD ExploitのPCAP
* DCERPCとEPMという見慣れないプロトコルが見える
* pcapの分析の際は特定のエクスプロイトが持っているIOC（Indicators of Compromise）に注意する
  * Threat Intelligence？
    * Roomの対象外なので自分で調べろとのこと
* この攻撃に関する事前知識から、ハッシュをダンプするためにsecretsdumpを使用していることがわかるらしい
  * SecretsdumpはSMB2/3とDRSUAPIを悪用してこれを行うので、このトラフィックはsecretsdumpであると推測できるとのこと
